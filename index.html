<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8" />
<title>Cash Register</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>
  :root {
    --card-pad: 14px;
    --card-radius: 12px;
    --gap: 14px;
    --font-size: 18px;    /* unified size across the app */
    --btn-pad: 12px 14px;
  }
  * { box-sizing: border-box; }
  body {
    font-family: Arial, Helvetica, sans-serif;
    margin: 0 auto;
    max-width: 720px;
    padding: 20px;
    text-align: center;
    font-size: var(--font-size); /* unified */
    line-height: 1.35;
  }
  /* Grid + Card (shared across Main & Admin) */
  .grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: var(--gap);
    align-items: stretch;
  }
  @media (max-width: 640px) {
    .grid { grid-template-columns: 1fr; }
  }
  .card {
    border: 1px solid #ddd;
    border-radius: var(--card-radius);
    padding: var(--card-pad);
    text-align: left;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
    min-height: 160px; /* consistent visual rhythm */
  }
  .card h3 {
    margin: 0 0 8px;
    font-weight: bold;
    text-align: center;
  }
  .kv { margin: 4px 0; }

  /* Buttons */
  button {
    padding: var(--btn-pad);
    font-size: var(--font-size); /* unified size */
    border-radius: 10px;
    border: 1px solid #ccc;
    background: #f7f7f7;
    cursor: pointer;
  }
  button:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }
  .btn-row {
    display: flex;
    gap: var(--gap);
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn-full { width: 100%; }
  .selected { background: #000; color: #fff; border-color: #000; }

  /* Quantity rows in Items card */
  .item-row {
    display: grid;
    grid-template-columns: 1fr auto auto auto; /* Name | Price | + | - with qty centered separately */
    align-items: center;
    gap: 10px;
    padding: 6px 0;
    border-bottom: 1px dashed #e6e6e6;
  }
  .item-row:last-child { border-bottom: none; }
  .item-name { text-align: left; }
  .price { text-align: center; min-width: 50px; }
  .qty-controls {
    display: grid;
    grid-template-columns: auto 50px auto;
    align-items: center;
    justify-items: center;
    gap: 8px;
  }
  .qty-badge {
    display: inline-block;
    min-width: 44px;
    text-align: center;
    padding: 6px 8px;
    border: 1px solid #ddd;
    border-radius: 8px;
    background: #fff;
  }

  /* Totals / Comp Color */
  .highlight { color: #c00; font-weight: bold; }

  /* Admin loading */
  #admin-loading { display: none; font-style: italic; margin: 8px 0; }
  #admin-content { display: none; }

  /* Screen toggles */
  #admin-screen { display: none; }

  /* Headings (kept same weight/size baseline) */
  .section-title {
    margin: 8px 0 12px;
    font-weight: bold;
  }
</style>
</head>
<body>

<!-- ===== MAIN (POS) ===== -->
<div id="main-screen">
  <div class="grid" style="margin-bottom: var(--gap)">
    <!-- Items -->
    <div class="card">
      <h3>Items</h3>
      <div class="item-row" aria-label="Burger">
        <div class="item-name">Burger</div>
        <div class="price">$7</div>
        <div class="qty-controls">
          <button onclick="changeQty('burger',1)" aria-label="Add Burger">+</button>
          <span id="burgerQty" class="qty-badge" aria-live="polite">0</span>
          <button onclick="changeQty('burger',-1)" aria-label="Remove Burger">-</button>
        </div>
      </div>
      <div class="item-row" aria-label="Hot Dog">
        <div class="item-name">Hot Dog</div>
        <div class="price">$5</div>
        <div class="qty-controls">
          <button onclick="changeQty('hotdog',1)" aria-label="Add Hot Dog">+</button>
          <span id="hotdogQty" class="qty-badge" aria-live="polite">0</span>
          <button onclick="changeQty('hotdog',-1)" aria-label="Remove Hot Dog">-</button>
        </div>
      </div>
    </div>

    <!-- Payment -->
    <div class="card">
      <h3>Payment</h3>
      <div class="btn-row" style="margin-top: 6px;">
        <button id="cashBtn" class="btn-full" onclick="selectPayment('cash')">Cash</button>
        <button id="cardBtn" class="btn-full" onclick="selectPayment('card')">Card</button>
      </div>
      <div class="kv" style="text-align:center;margin-top:8px">
        Total: $<span id="total">0</span>
      </div>
    </div>

    <!-- Actions -->
    <div class="card">
      <h3>Actions</h3>
      <div class="btn-row" style="margin-top: 6px;">
        <button id="submitBtn" class="btn-full" onclick="submitOrder(event)">Submit Order</button>
      </div>
      <div class="btn-row" style="margin-top: 8px;">
        <button class="btn-full" onclick="showAdmin()">Admin Panel</button>
        <button class="btn-full" onclick="toggleComp()">Comp Order</button>
      </div>
      <div class="kv" style="text-align:center;margin-top:8px">
        <span id="compHint" aria-live="polite"></span>
      </div>
    </div>

    <!-- (Optional) Quick Summary (mirrors total for at-a-glance) -->
    <div class="card">
      <h3>Summary</h3>
      <div class="kv" id="summaryLines" style="text-align:center;">
        0 Burgers, 0 Hot Dogs
      </div>
    </div>
  </div>
</div>

<!-- ===== ADMIN ===== -->
<div id="admin-screen">
  <div class="section-title">Admin Panel</div>

  <div id="admin-loading" aria-live="polite">Loading admin data…</div>

  <div id="admin-content">
    <div class="card" style="text-align:center; margin-bottom: var(--gap);">
      <div class="kv">
        <label for="dateSelect"><strong>Date:</strong></label>
        <select id="dateSelect" onchange="loadStats()"></select>
      </div>
      <div id="totalBlock" class="kv" style="margin-top:8px;"></div>
    </div>

    <div class="grid">
      <div class="card">
        <h3>Hot Dogs</h3>
        <div class="kv" id="hdMoney"></div>
        <div class="kv" id="hdItems"></div>
      </div>
      <div class="card">
        <h3>Cash</h3>
        <div class="kv" id="cashMoney"></div>
        <div class="kv" id="cashItems"></div>
      </div>
      <div class="card">
        <h3>Burger</h3>
        <div class="kv" id="bgMoney"></div>
        <div class="kv" id="bgItems"></div>
      </div>
      <div class="card">
        <h3>Card</h3>
        <div class="kv" id="cardMoney"></div>
        <div class="kv" id="cardItems"></div>
      </div>
    </div>

    <div class="btn-row" style="margin-top: var(--gap);">
      <button class="btn-full" onclick="showMain()">Back to Home</button>
    </div>
  </div>
</div>

<script>
/* ==== CONFIG ==== */
const API_URL = "https://script.google.com/macros/s/AKfycbwb_KZrwBErcWTsvnERHS33q0xXggrP1ymF_uxkH0dHiyxoY_nwZv2H4RsHcJfQAcY3/exec";
const prices = { burger: 7, hotdog: 5 };

/* ==== STATE ==== */
let qty = { burger: 0, hotdog: 0 };
let compOrder = false;
let selectedPayment = null;
let allSales = [];

/* ==== POS LOGIC ==== */
function changeQty(item, delta) {
  qty[item] = Math.max(0, qty[item] + delta);
  renderPOS();
}
function toggleComp() {
  compOrder = !compOrder;
  renderPOS();
}
function selectPayment(type) {
  selectedPayment = type;
  document.getElementById("cashBtn").classList.toggle("selected", type === "cash");
  document.getElementById("cardBtn").classList.toggle("selected", type === "card");
}

/* Render Main UI */
function renderPOS() {
  // quantities
  document.getElementById("burgerQty").textContent = qty.burger;
  document.getElementById("hotdogQty").textContent = qty.hotdog;

  // total
  let total = qty.burger * prices.burger + qty.hotdog * prices.hotdog;
  const totalEl = document.getElementById("total");
  if (compOrder) total = 0;
  totalEl.textContent = total;
  totalEl.className = compOrder ? "highlight" : "";

  // comp hint + summary
  const compHint = document.getElementById("compHint");
  compHint.textContent = compOrder ? "Comp active: total is $0 (items still counted as sold)" : "";
  document.getElementById("summaryLines").textContent =
    `${qty.burger} Burgers, ${qty.hotdog} Hot Dogs`;
}

/* Submit with loading state */
async function submitOrder(e) {
  const btn = document.getElementById("submitBtn");

  if (qty.burger === 0 && qty.hotdog === 0) return alert("No items selected");
  if (!selectedPayment) return alert("Select a payment method");

  btn.textContent = "Loading…";
  btn.disabled = true;

  const today = new Date().toISOString().slice(0,10);
  try {
    await fetch(API_URL, {
      method: "POST",
      body: JSON.stringify({
        date: today,
        burger: qty.burger,
        hotdog: qty.hotdog,
        comp: compOrder,
        payment: selectedPayment
      })
    });
    // reset state
    qty = { burger: 0, hotdog: 0 };
    compOrder = false;
    selectedPayment = null;
    document.getElementById("cashBtn").classList.remove("selected");
    document.getElementById("cardBtn").classList.remove("selected");
    renderPOS();
    alert("Order submitted");
  } catch (err) {
    alert("Error submitting order. Please try again.");
  } finally {
    btn.textContent = "Submit Order";
    btn.disabled = false;
  }
}

/* ==== ADMIN LOGIC ==== */
async function showAdmin() {
  // Switch screens
  document.getElementById("main-screen").style.display = "none";
  document.getElementById("admin-screen").style.display = "block";

  // Show loading
  const loadingEl = document.getElementById("admin-loading");
  const contentEl = document.getElementById("admin-content");
  const dateSelect = document.getElementById("dateSelect");
  loadingEl.style.display = "block";
  contentEl.style.display = "none";
  dateSelect.disabled = true;
  dateSelect.innerHTML = "";

  try {
    const res = await fetch(API_URL);
    allSales = await res.json();

    const dates = [...new Set(allSales.map(r => r.date))].filter(Boolean);
    dates.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d; opt.textContent = d;
      dateSelect.appendChild(opt);
    });

    if (dates.length > 0) {
      loadStats();
      contentEl.style.display = "block";
    } else {
      document.getElementById("totalBlock").innerHTML =
        "<strong>Total</strong><br>No data available yet.";
      contentEl.style.display = "block";
    }
  } catch (e) {
    alert("Error loading admin data. Please try again.");
  } finally {
    loadingEl.style.display = "none";
    dateSelect.disabled = false;
  }
}

function loadStats() {
  const date = document.getElementById("dateSelect").value;
  const data = allSales.filter(r => r.date === date);

  const stats = {
    totalMoney: 0, totalItems: 0,
    burgerMoney: 0, burgerItems: 0,
    hotdogMoney: 0, hotdogItems: 0,
    cashMoney: 0, cashItems: 0,
    cardMoney: 0, cardItems: 0
  };

  data.forEach(o => {
    const isComp = (o.comp === true || o.comp === "true");
    const orderTotal = isComp ? 0 : (Number(o.burger)*prices.burger + Number(o.hotdog)*prices.hotdog);
    stats.totalMoney += orderTotal;
    stats.totalItems += Number(o.burger) + Number(o.hotdog);

    stats.burgerMoney += isComp ? 0 : Number(o.burger)*prices.burger;
    stats.burgerItems += Number(o.burger);

    stats.hotdogMoney += isComp ? 0 : Number(o.hotdog)*prices.hotdog;
    stats.hotdogItems += Number(o.hotdog);

    if (o.payment === "cash") {
      stats.cashMoney += orderTotal;
      stats.cashItems += Number(o.burger) + Number(o.hotdog);
    } else {
      stats.cardMoney += orderTotal;
      stats.cardItems += Number(o.burger) + Number(o.hotdog);
    }
  });

  document.getElementById("totalBlock").innerHTML =
    `<strong>Total</strong><br>Money: $${stats.totalMoney} &nbsp;|&nbsp; Items: ${stats.totalItems}`;

  document.getElementById("hdMoney").textContent   = `Money: $${stats.hotdogMoney}`;
  document.getElementById("hdItems").textContent   = `Items: ${stats.hotdogItems}`;
  document.getElementById("bgMoney").textContent   = `Money: $${stats.burgerMoney}`;
  document.getElementById("bgItems").textContent   = `Items: ${stats.burgerItems}`;
  document.getElementById("cashMoney").textContent = `Money: $${stats.cashMoney}`;
  document.getElementById("cashItems").textContent = `Items: ${stats.cashItems}`;
  document.getElementById("cardMoney").textContent = `Money: $${stats.cardMoney}`;
  document.getElementById("cardItems").textContent = `Items: ${stats.cardItems}`;
}

function showMain() {
  document.getElementById("admin-screen").style.display = "none";
  document.getElementById("main-screen").style.display = "block";
}

/* init */
renderPOS();
</script>
</body>
</html>
