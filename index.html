<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HP BBQ Cash Register</title>
<style>
  body {
    font-family: Arial;
    padding: 20px;
    max-width: 600px;
    margin: auto;
    text-align: center;
  }
  h1 {
    margin-bottom: 15px;
  }
  table {
    width: auto;
    margin: auto;
    border-collapse: collapse;
    margin-bottom: 15px;
  }
  td { padding: 8px; text-align: center; }
  button {
    margin: 3px;
    padding: 8px 12px;
    font-size: 1em;
    cursor: pointer;
  }
  .highlight { color: red; font-weight: bold; }
  .selected { background-color: black; color: white; }

  /* Admin layout */
  .admin-total {
    margin-top: 6px;
    margin-bottom: 8px;
    text-align: center;
  }
  .admin-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 14px;
    text-align: left;
  }
  .card {
    border: 1px solid #ddd;
    border-radius: 8px;
    padding: 10px 12px;
  }
  .card h3 {
    margin: 0 0 6px 0;
    font-size: 1.1em;
    font-weight: bold;
    text-align: center;
  }
  .kv { margin: 2px 0; }

  /* Lock screen */
  #lock-screen {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: white;
    z-index: 9999;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #code-display {
    font-size: 1.5em;
    letter-spacing: 5px;
    margin-bottom: 10px;
  }
  .keypad {
    display: grid;
    grid-template-columns: repeat(3, 60px);
    gap: 10px;
    justify-content: center;
  }
  .keypad button {
    font-size: 1.2em;
    padding: 10px;
  }
</style>
</head>
<body>

<!-- LOCK SCREEN -->
<div id="lock-screen">
  <h2>Enter Access Code</h2>
  <div id="code-display">____</div>
  <div class="keypad">
    <button onclick="pressNum(1)">1</button>
    <button onclick="pressNum(2)">2</button>
    <button onclick="pressNum(3)">3</button>
    <button onclick="pressNum(4)">4</button>
    <button onclick="pressNum(5)">5</button>
    <button onclick="pressNum(6)">6</button>
    <button onclick="pressNum(7)">7</button>
    <button onclick="pressNum(8)">8</button>
    <button onclick="pressNum(9)">9</button>
    <button onclick="clearCode()">←</button>
    <button onclick="pressNum(0)">0</button>
    <button onclick="checkCode()">✔</button>
  </div>
  <div id="lock-error" style="color:red; margin-top:10px;"></div>
</div>

<!-- MAIN SCREEN -->
<div id="main-screen" style="display:none">
  <h1>HP BBQ</h1>

  <table>
    <tr>
      <td>Burger</td>
      <td>$7</td>
      <td>
        <button onclick="changeQty('burger',1)">+</button>
        <span id="burgerQty">0</span>
        <button onclick="changeQty('burger',-1)">-</button>
      </td>
    </tr>
    <tr>
      <td>Hot Dog</td>
      <td>$5</td>
      <td>
        <button onclick="changeQty('hotdog',1)">+</button>
        <span id="hotdogQty">0</span>
        <button onclick="changeQty('hotdog',-1)">-</button>
      </td>
    </tr>
  </table>

  <div>Total: $<span id="total">0</span></div>

  <div>
    Payment:
    <button id="cashBtn" onclick="selectPayment('cash')">Cash</button>
    <button id="cardBtn" onclick="selectPayment('card')">Card</button>
  </div>
  <br>
  <button onclick="toggleComp()">Comp Order</button>
  <br><br>
  <button id="submitBtn" onclick="submitOrder()">Submit Order</button>
  <br><br>
  <button onclick="showAdmin()">Admin Panel</button>
</div>

<!-- ADMIN SCREEN -->
<div id="admin-screen" style="display:none">
  <h2>Date:
    <select id="dateSelect" onchange="loadStats()"></select>
  </h2>

  <div id="admin-loading">Loading...</div>
  <div id="admin-content" style="display:none">
    <div id="totalBlock" class="admin-total"></div>

    <div class="admin-grid">
      <div class="card">
        <h3>Hot Dogs</h3>
        <div class="kv" id="hdMoney"></div>
        <div class="kv" id="hdItems"></div>
      </div>
      <div class="card">
        <h3>Cash</h3>
        <div class="kv" id="cashMoney"></div>
        <div class="kv" id="cashItems"></div>
      </div>
      <div class="card">
        <h3>Burger</h3>
        <div class="kv" id="bgMoney"></div>
        <div class="kv" id="bgItems"></div>
      </div>
      <div class="card">
        <h3>Card</h3>
        <div class="kv" id="cardMoney"></div>
        <div class="kv" id="cardItems"></div>
      </div>
    </div>
  </div>
  <br>
  <button onclick="showMain()">Back to Home</button>
</div>

<script>
// ====== CONFIG ======
const API_URL = "https://script.google.com/macros/s/AKfycbwb_KZrwBErcWTsvnERHS33q0xXggrP1ymF_uxkH0dHiyxoY_nwZv2H4RsHcJfQAcY3/exec";
const prices = { burger: 7, hotdog: 5 };
const ACCESS_CODE = "5253";

// ====== STATE ======
let qty = { burger: 0, hotdog: 0 };
let compOrder = false;
let selectedPayment = null;
let allSales = [];

// ====== LOCK SCREEN ======
let enteredCode = "";
function pressNum(num) {
  if (enteredCode.length < 4) {
    enteredCode += num;
    updateCodeDisplay();
  }
}
function clearCode() {
  enteredCode = enteredCode.slice(0, -1);
  updateCodeDisplay();
}
function updateCodeDisplay() {
  let display = enteredCode.padEnd(4, "_").split("").join(" ");
  document.getElementById("code-display").textContent = display;
}
function checkCode() {
  if (enteredCode === ACCESS_CODE) {
    document.getElementById("lock-screen").style.display = "none";
    document.getElementById("main-screen").style.display = "block";
  } else {
    document.getElementById("lock-error").textContent = "Incorrect code";
    enteredCode = "";
    updateCodeDisplay();
  }
}

// ====== MAIN PAGE ======
function changeQty(item, amount) {
  qty[item] = Math.max(0, qty[item] + amount);
  updateDisplay();
}
function updateDisplay() {
  document.getElementById("burgerQty").innerText = qty.burger;
  document.getElementById("hotdogQty").innerText = qty.hotdog;
  let total = qty.burger * prices.burger + qty.hotdog * prices.hotdog;
  if (compOrder) total = 0;
  document.getElementById("total").innerText = total;
  document.getElementById("total").className = compOrder ? "highlight" : "";
}
function toggleComp() { compOrder = !compOrder; updateDisplay(); }
function selectPayment(type) {
  selectedPayment = type;
  document.getElementById("cashBtn").classList.toggle("selected", type === 'cash');
  document.getElementById("cardBtn").classList.toggle("selected", type === 'card');
}
async function submitOrder() {
  const submitBtn = document.getElementById("submitBtn");
  if (qty.burger === 0 && qty.hotdog === 0) { alert("No items selected"); return; }
  if (!selectedPayment) { alert("Select a payment method"); return; }
  submitBtn.textContent = "Loading...";
  submitBtn.disabled = true;
  const today = new Date().toISOString().slice(0,10);
  await fetch(API_URL, {
    method: "POST",
    body: JSON.stringify({
      date: today,
      burger: qty.burger,
      hotdog: qty.hotdog,
      comp: compOrder,
      payment: selectedPayment
    })
  });
  qty = { burger: 0, hotdog: 0 };
  compOrder = false;
  selectedPayment = null;
  document.getElementById("cashBtn").classList.remove("selected");
  document.getElementById("cardBtn").classList.remove("selected");
  updateDisplay();
  submitBtn.textContent = "Submit Order";
  submitBtn.disabled = false;
  alert("Order submitted");
}

// ====== ADMIN ======
async function showAdmin() {
  document.getElementById("main-screen").style.display = "none";
  document.getElementById("admin-screen").style.display = "block";
  const loadingEl = document.getElementById("admin-loading");
  const contentEl = document.getElementById("admin-content");
  const dateSelect = document.getElementById("dateSelect");
  loadingEl.style.display = "block";
  contentEl.style.display = "none";
  dateSelect.disabled = true;
  dateSelect.innerHTML = "";
  try {
    const res = await fetch(API_URL);
    allSales = await res.json();
    const dates = [...new Set(allSales.map(r => r.date))].filter(Boolean);
    dates.forEach(d => {
      const opt = document.createElement("option");
      opt.value = d;
      const [y, m, day] = d.split("-");
      opt.textContent = `${parseInt(m)}/${parseInt(day)}/${y}`;
      dateSelect.appendChild(opt);
    });
    if (dates.length > 0) {
      loadStats();
      contentEl.style.display = "block";
    }
  } catch {
    alert("Error loading admin data");
  } finally {
    loadingEl.style.display = "none";
    dateSelect.disabled = false;
  }
}
function loadStats() {
  const date = document.getElementById("dateSelect").value;
  const data = allSales.filter(r => r.date === date);
  const stats = {
    totalMoney: 0, totalItems: 0,
    burgerMoney: 0, burgerItems: 0,
    hotdogMoney: 0, hotdogItems: 0,
    cashMoney: 0, cashItems: 0,
    cardMoney: 0, cardItems: 0
  };
  data.forEach(o => {
    const isComp = (o.comp === true || o.comp === "true");
    const orderTotal = isComp ? 0 : (Number(o.burger)*prices.burger + Number(o.hotdog)*prices.hotdog);
    stats.totalMoney += orderTotal;
    stats.totalItems += Number(o.burger) + Number(o.hotdog);
    stats.burgerMoney += isComp ? 0 : Number(o.burger)*prices.burger;
    stats.burgerItems += Number(o.burger);
    stats.hotdogMoney += isComp ? 0 : Number(o.hotdog)*prices.hotdog;
    stats.hotdogItems += Number(o.hotdog);
    if (o.payment === "cash") {
      stats.cashMoney += orderTotal;
      stats.cashItems += Number(o.burger) + Number(o.hotdog);
    } else {
      stats.cardMoney += orderTotal;
      stats.cardItems += Number(o.burger) + Number(o.hotdog);
    }
  });
  document.getElementById("totalBlock").innerHTML =
    `<strong>Total</strong><br>Money: $${stats.totalMoney} | Items: ${stats.totalItems}`;
  document.getElementById("hdMoney").textContent   = `Money: $${stats.hotdogMoney}`;
  document.getElementById("hdItems").textContent   = `Items: ${stats.hotdogItems}`;
  document.getElementById("bgMoney").textContent   = `Money: $${stats.burgerMoney}`;
  document.getElementById("bgItems").textContent   = `Items: ${stats.burgerItems}`;
  document.getElementById("cashMoney").textContent = `Money: $${stats.cashMoney}`;
  document.getElementById("cashItems").textContent = `Items: ${stats.cashItems}`;
  document.getElementById("cardMoney").textContent = `Money: $${stats.cardMoney}`;
  document.getElementById("cardItems").textContent = `Items: ${stats.cardItems}`;
}
function showMain() {
  document.getElementById("admin-screen").style.display = "none";
  document.getElementById("main-screen").style.display = "block";
}
updateDisplay();
</script>
</body>
</html>
